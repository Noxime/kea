#! /bin/bash

# Make sure they provided a path
if [ -z $1 ]
then
    echo "Usage: ./configure <game path>"
    exit 1
fi


# Make the path relative ;)
rel=$(perl -e 'use File::Spec; print File::Spec->abs2rel(@ARGV) . "\n"' $1 $(pwd))
# get the package name
name=$(pcregrep -o1 'name = "(.*)"'  $rel/Cargo.toml)

if [ -z $name ]
then
    echo "ERROR: '$rel' is not a valid crate"
    exit 1
fi

echo "Configuring kea to use '$name'"

if [[ "$OSTYPE" == "darwin" ]]; then
	sed -i "" "s/game.*}/game = { path = \"..\/$rel\", package = \"$name\" }/g" target-desktop/Cargo.toml
	sed -i "" "s/game.*}/game = { path = \"..\/$rel\", package = \"$name\" }/g" target-android/Cargo.toml
	sed -i "" "s/game.*}/game = { path = \"..\/$rel\", package = \"$name\" }/g" target-ios/Cargo.toml
	sed -i "" "s/game.*}/game = { path = \"..\/$rel\", package = \"$name\" }/g" target-switch/Cargo.toml
else
	sed -i "s/game.*}/game = { path = \"..\/$rel\", package = \"$name\" }/g" target-desktop/Cargo.toml
        sed -i "s/game.*}/game = { path = \"..\/$rel\", package = \"$name\" }/g" target-android/Cargo.toml
        sed -i "s/game.*}/game = { path = \"..\/$rel\", package = \"$name\" }/g" target-ios/Cargo.toml
        sed -i "s/game.*}/game = { path = \"..\/$rel\", package = \"$name\" }/g" target-switch/Cargo.toml
fi
